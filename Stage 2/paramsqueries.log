airline=# PREPARE search_emp_name (text, text) AS
airline-# SELECT *
airline-# FROM employee
airline-# WHERE first_name like FORMAT('%%%s%%', $1) AND last_name like FORMAT('%%%s%%', $2);
PREPARE
Time: 0.302 ms

airline=# execute search_emp_name('Edw','L');
 emp_id | first_name | last_name | wage |    dob     |                      address                       | hire_date
--------+------------+-----------+------+------------+----------------------------------------------------+------------
    653 | Edward     | Liu       | 4064 | 1971-12-16 | 5378 Allison Street, Arvada, CO, 80002             | 2012-11-08
   4251 | Edwin      | Lambert   | 5593 | 2001-04-04 | 226 Tranquility Lane, Saint Albans Town, VT, 05488 | 2012-09-28
(2 rows)
Time: 2.173 ms

airline=# PREPARE min_carousel_load(int) AS
airline-# SELECT carousel_id, SUM(total) as kg FROM
airline-# (
airline(# SELECT carousel_id, total FROM
airline(# (
airline(# SELECT aircraft_rn as rn, COUNT(weight) AS total
airline(# FROM luggage
airline(# GROUP BY aircraft_rn
airline(# ORDER BY total DESC
airline(# )
airline(# INNER JOIN carousel_aircraft
airline(# ON rn = carousel_aircraft.aircraft_rn
airline(# )
airline-# GROUP BY carousel_id
airline-# HAVING SUM(total) >= $1
airline-# ORDER BY kg desc;
PREPARE
Time: 2.228 ms

airline=# execute min_carousel_load(500);
 carousel_id | kg
-------------+-----
        2285 | 742
         616 | 706
         919 | 703
        3022 | 701
        3056 | 700
         991 | 693
        1266 | 690
        3002 | 690
         921 | 688
        2152 | 682
        1274 | 678
        2959 | 675
        1213 | 675
        3006 | 671
        1811 | 667
        3037 | 667
        3015 | 666
        1134 | 666
        3020 | 664
        1695 | 664
        3132 | 663
        1384 | 663
        2344 | 655
        3027 | 648
         935 | 645
        3047 | 643
        1334 | 640
        2059 | 633
        3149 | 624
        1761 | 619
          56 | 617
(31 rows)
Time: 21.505 ms


airline=# PREPARE plane_cargo_dist(text) AS
airline-# SELECT
airline-#     l_type AS type,
airline-# round(
airline(# AVG(amount) / (
airline(# SELECT SUM(amount) FROM
airline(# (
airline(# SELECT type as l_type, count(type) AS amount FROM
airline(# (
airline(# SELECT l.aircraft_rn, l.type FROM
airline(# (
airline(# SELECT * FROM luggage
airline(# WHERE aircraft_rn = $1
airline(#
airline(# ) AS l
airline(# JOIN carousel_aircraft
airline(# ON l.aircraft_rn = carousel_aircraft.aircraft_rn
airline(# )
airline(# GROUP BY type
airline(# )
airline(# ), 2
airline(# ) AS percent
airline-# FROM
airline-# (
airline(# SELECT type AS l_type, count(type) AS amount FROM
airline(# (
airline(# SELECT l.aircraft_rn, l.type FROM
airline(# (
airline(# SELECT * FROM luggage
airline(# WHERE aircraft_rn = $1
airline(#
airline(# ) AS l
airline(# JOIN carousel_aircraft
airline(# ON l.aircraft_rn = carousel_aircraft.aircraft_rn
airline(# )
airline(# GROUP BY type
airline(# )
airline-# GROUP BY l_type;
PREPARE
Time: 0.529 ms

airline=# execute plane_cargo_dist('N-368UF');
   type    | percent
-----------+---------
 checked   |    0.15
 carryOn   |    0.14
 personal  |    0.14
 special   |    0.18
 fragile   |    0.20
 equipment |    0.18
(6 rows)
Time: 19.372 ms


airline=# PREPARE dest_load_count(text) AS
airline-# -- iata with its weights
airline-# SELECT dest, sum, count FROM
airline-# (
airline(# SELECT dest, SUM(total_kg) FROM
airline(# (
airline(# -- dest and its weight
airline(# SELECT iata as dest, total_kg FROM
airline(# (
airline(# -- planes their kg with their carousel
airline(# SELECT rn, total_kg, carousel_id FROM
airline(# (
airline(# -- planes and their kg
airline(# SELECT aircraft_rn as rn, COUNT(weight) AS total_kg
airline(# FROM luggage
airline(# GROUP BY aircraft_rn
airline(# )
airline(# JOIN carousel_aircraft
airline(# ON rn = carousel_aircraft.aircraft_rn
airline(# ) AS x
airline(# JOIN carousel
airline(# ON x.carousel_id = carousel.carousel_id
airline(# )
airline(# GROUP BY dest
airline(# HAVING dest = $1
airline(# )
airline-# JOIN
airline-# (
airline(# -- iata with its plane count
airline(# SELECT iata, COUNT(iata) FROM carousel_aircraft
airline(# JOIN carousel
airline(# ON carousel_aircraft.carousel_id = carousel.carousel_id
airline(# GROUP BY iata
airline(# HAVING iata = $1
airline(# )
airline-# ON dest = iata;
PREPARE
Time: 0.866 ms

airline=# execute dest_load_count('CGK');
 dest | sum  | count
------+------+-------
 CGK  | 5566 |    16
(1 row)
Time: 22.112 ms